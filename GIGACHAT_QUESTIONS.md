# –í–æ–ø—Ä–æ—Å—ã –∏ –Ω–µ—è—Å–Ω–æ—Å—Ç–∏ –¥–ª—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ GigaChatProvider

## üìã –°—Ç–∞—Ç—É—Å –∏–∑—É—á–µ–Ω–∏—è

### ‚úÖ –ò–∑—É—á–µ–Ω–æ:

1. **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞:**
   - `BaseProvider` - –∞–±—Å—Ç—Ä–∞–∫—Ç–Ω—ã–π –∫–ª–∞—Å—Å —Å –º–µ—Ç–æ–¥–∞–º–∏ `generate()` –∏ `health_check()`
   - `ProviderConfig` - –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ Pydantic (name, api_key, base_url, timeout, max_retries, model)
   - `GenerationParams` - –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ (temperature, max_tokens, top_p, stop)
   - –ò–µ—Ä–∞—Ä—Ö–∏—è –∏—Å–∫–ª—é—á–µ–Ω–∏–π: `ProviderError`, `AuthenticationError`, `RateLimitError`, `TimeoutError`, `InvalidRequestError`
   - `MockProvider` - –ø—Ä–∏–º–µ—Ä —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ —Å –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º–∏ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
   - `Router` - –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —á–µ—Ä–µ–∑ `add_provider()`
   - –≠–∫—Å–ø–æ—Ä—Ç —á–µ—Ä–µ–∑ `providers/__init__.py`

2. **–ü–∞—Ç—Ç–µ—Ä–Ω—ã –∏–∑ –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã:**
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `httpx` –¥–ª—è async HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤ (—É–∂–µ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è—Ö)
   - –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ `self.logger`
   - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ `_retry_with_backoff()` –∏–∑ BaseProvider –¥–ª—è retry-–ª–æ–≥–∏–∫–∏
   - Health check –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `bool`
   - `generate()` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `prompt: str` –∏ `params: Optional[GenerationParams]` ‚Üí –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `str`

---

## ‚ùì –í–æ–ø—Ä–æ—Å—ã –¥–ª—è —É—Ç–æ—á–Ω–µ–Ω–∏—è

### 1. OAuth2 –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞–º–∏

#### 1.1. –•—Ä–∞–Ω–µ–Ω–∏–µ access_token
- **–í–æ–ø—Ä–æ—Å:** –ì–¥–µ —Ö—Ä–∞–Ω–∏—Ç—å `access_token` –≤ –∫–ª–∞—Å—Å–µ `GigaChatProvider`?
  - **–í–∞—Ä–∏–∞–Ω—Ç A:** –ü–æ–ª–µ –∫–ª–∞—Å—Å–∞ `self._access_token: Optional[str] = None`
  - **–í–∞—Ä–∏–∞–Ω—Ç B:** –ü–æ–ª–µ –∫–ª–∞—Å—Å–∞ —Å –≤—Ä–µ–º–µ–Ω–µ–º –∏—Å—Ç–µ—á–µ–Ω–∏—è `self._token_expires_at: Optional[float] = None`
  - **–í–∞—Ä–∏–∞–Ω—Ç C:** –û–±–∞ –ø–æ–ª—è –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ –∫–æ–Ω—Ç—Ä–æ–ª—è

#### 1.2. Thread-safe –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
- **–í–æ–ø—Ä–æ—Å:** –ö–∞–∫ –æ–±–µ—Å–ø–µ—á–∏—Ç—å thread-safe –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –ø—Ä–∏ –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–∞—Ö?
  - **–í–∞—Ä–∏–∞–Ω—Ç A:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `asyncio.Lock()` –¥–ª—è –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
  - **–í–∞—Ä–∏–∞–Ω—Ç B:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `asyncio.Event()` –¥–ª—è –æ–∂–∏–¥–∞–Ω–∏—è –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
  - **–í–∞—Ä–∏–∞–Ω—Ç C:** –ö–æ–º–±–∏–Ω–∞—Ü–∏—è Lock + –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤—Ä–µ–º–µ–Ω–∏ –∏—Å—Ç–µ—á–µ–Ω–∏—è

**–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `asyncio.Lock()` —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –≤—Ä–µ–º–µ–Ω–∏ –∏—Å—Ç–µ—á–µ–Ω–∏—è:
```python
self._token_lock = asyncio.Lock()
self._access_token: Optional[str] = None
self._token_expires_at: Optional[float] = None
```

#### 1.3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –ø—Ä–∏ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ –≤–æ –≤—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞
- **–í–æ–ø—Ä–æ—Å:** –ß—Ç–æ –¥–µ–ª–∞—Ç—å, –µ—Å–ª–∏ —Ç–æ–∫–µ–Ω –∏—Å—Ç–µ–∫ –≤–æ –≤—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è `generate()`?
  - **–í–∞—Ä–∏–∞–Ω—Ç A:** –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–∏—Ç—å —Ç–æ–∫–µ–Ω –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–ø—Ä–æ—Å (1 —Ä–∞–∑)
  - **–í–∞—Ä–∏–∞–Ω—Ç B:** –í—ã–±—Ä–æ—Å–∏—Ç—å `AuthenticationError` –∏ –ø—É—Å—Ç—å –≤—ã–∑—ã–≤–∞—é—â–∏–π –∫–æ–¥ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç
  - **–í–∞—Ä–∏–∞–Ω—Ç C:** –û–±–Ω–æ–≤–∏—Ç—å —Ç–æ–∫–µ–Ω –∑–∞—Ä–∞–Ω–µ–µ (–ø—Ä–æ–≤–µ—Ä—è—Ç—å –ø–µ—Ä–µ–¥ –∫–∞–∂–¥—ã–º –∑–∞–ø—Ä–æ—Å–æ–º)

**–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:** –í–∞—Ä–∏–∞–Ω—Ç A - –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å –æ–¥–Ω–∏–º retry.

#### 1.4. OAuth2 endpoint –∏ —Ñ–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞
- **–í–æ–ø—Ä–æ—Å:** –¢–æ—á–Ω—ã–π URL –∏ —Ñ–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ç–æ–∫–µ–Ω–∞?
  - URL: `https://ngw.devices.sberbank.ru:9443/api/v2/oauth` –∏–ª–∏ –¥—Ä—É–≥–æ–π?
  - Headers: `Authorization: Bearer <authorization_key>` –∏–ª–∏ `Authorization: <authorization_key>`?
  - Body: `grant_type=client_credentials` –∏–ª–∏ JSON?
  - Response: —Ñ–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞ (–≥–¥–µ `access_token`, `expires_in`)?

**–¢—Ä–µ–±—É–µ—Ç—Å—è:** –£—Ç–æ—á–Ω–∏—Ç—å –∏–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –∏–ª–∏ –ø—Ä–∏–º–µ—Ä–æ–≤.

---

### 2. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è ProviderConfig

#### 2.1. –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –¥–ª—è GigaChat
- **–í–æ–ø—Ä–æ—Å:** –ö–∞–∫–∏–µ –ø–æ–ª—è `ProviderConfig` –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã –¥–ª—è GigaChat?
  - `name` - –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω (–∏–∑ BaseProvider)
  - `api_key` - —ç—Ç–æ Authorization key –¥–ª—è OAuth2? –ò–ª–∏ –æ—Ç–¥–µ–ª—å–Ω–æ–µ –ø–æ–ª–µ?
  - `base_url` - –Ω—É–∂–µ–Ω –ª–∏? –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π `https://gigachat.devices.sberbank.ru/api/v1`?
  - `model` - –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω? –ö–∞–∫–∏–µ –º–æ–¥–µ–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã? (GigaChat-2-Pro, GigaChat-Pro, etc.)

**–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**
- `api_key` ‚Üí —Ö—Ä–∞–Ω–∏—Ç—å Authorization key –¥–ª—è OAuth2
- `base_url` ‚Üí –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π, –¥–µ—Ñ–æ–ª—Ç: `https://gigachat.devices.sberbank.ru/api/v1`
- `model` ‚Üí –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–π, –¥–µ—Ñ–æ–ª—Ç: `"GigaChat-Pro"` (–∏–ª–∏ –∫–∞–∫–∞—è –∞–∫—Ç—É–∞–ª—å–Ω–∞—è?)

#### 2.2. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
- **–í–æ–ø—Ä–æ—Å:** –ù—É–∂–Ω—ã –ª–∏ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –¥–ª—è GigaChat?
  - `scope` –¥–ª—è OAuth2? (–æ–±—ã—á–Ω–æ –Ω–µ –Ω—É–∂–µ–Ω –¥–ª—è client_credentials)
  - `oauth_url` –¥–ª—è –∫–∞—Å—Ç–æ–º–Ω–æ–≥–æ OAuth endpoint?
  - –î—Ä—É–≥–∏–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã?

---

### 3. API –∑–∞–ø—Ä–æ—Å—ã –∏ —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö

#### 3.1. –§–æ—Ä–º–∞—Ç messages –¥–ª—è GigaChat
- **–í–æ–ø—Ä–æ—Å:** –ö–∞–∫ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å `prompt: str` –≤ —Ñ–æ—Ä–º–∞—Ç `messages` –¥–ª—è GigaChat API?
  - **–í–∞—Ä–∏–∞–Ω—Ç A:** `[{"role": "user", "content": prompt}]` (–ø—Ä–æ—Å—Ç–æ–π)
  - **–í–∞—Ä–∏–∞–Ω—Ç B:** –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –¥–∏–∞–ª–æ–≥–∞ (—Å–ª–æ–∂–Ω–µ–µ, –Ω–æ –ø–æ–ª–µ–∑–Ω–µ–µ)
  - **–í–∞—Ä–∏–∞–Ω—Ç C:** –¢–æ–ª—å–∫–æ –ø—Ä–æ—Å—Ç–æ–π –≤–∞—Ä–∏–∞–Ω—Ç –Ω–∞ –ø–µ—Ä–≤–æ–º —ç—Ç–∞–ø–µ

**–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:** –í–∞—Ä–∏–∞–Ω—Ç A –Ω–∞ –ø–µ—Ä–≤–æ–º —ç—Ç–∞–ø–µ, –ø–æ—Ç–æ–º –º–æ–∂–Ω–æ —Ä–∞—Å—à–∏—Ä–∏—Ç—å.

#### 3.2. –ü–∞—Ä–∞–º–µ—Ç—Ä—ã –∑–∞–ø—Ä–æ—Å–∞
- **–í–æ–ø—Ä–æ—Å:** –ö–∞–∫–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç GigaChat API –≤ `/api/v1/chat/completions`?
  - –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ: `model`, `messages`
  - –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ: `max_tokens`, `temperature`, `top_p`, `stop` - –≤—Å–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è?
  - –î—Ä—É–≥–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã: `stream`, `n`, `presence_penalty`, `frequency_penalty`?

**–¢—Ä–µ–±—É–µ—Ç—Å—è:** –£—Ç–æ—á–Ω–∏—Ç—å –∏–∑ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.

#### 3.3. –§–æ—Ä–º–∞—Ç –æ—Ç–≤–µ—Ç–∞
- **–í–æ–ø—Ä–æ—Å:** –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞ –æ—Ç GigaChat API?
  - –ì–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞: `response.choices[0].message.content`?
  - –ï—Å—Ç—å –ª–∏ `usage` –¥–ª—è —Ç–æ–∫–µ–Ω–æ–≤?
  - –ï—Å—Ç—å –ª–∏ `finish_reason`?

**–¢—Ä–µ–±—É–µ—Ç—Å—è:** –ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞ –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.

#### 3.4. –ó–∞–≥–æ–ª–æ–≤–æ–∫ RqUID
- **–í–æ–ø—Ä–æ—Å:** –û–±—è–∑–∞—Ç–µ–ª–µ–Ω –ª–∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫ `RqUID: <uuid>`?
  - –ï—Å–ª–∏ –¥–∞, –≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å –Ω–æ–≤—ã–π UUID –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞?
  - –ò–ª–∏ –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –æ–¥–∏–Ω –¥–ª—è –≤—Å–µ—Ö –∑–∞–ø—Ä–æ—Å–æ–≤?

**–¢—Ä–µ–±—É–µ—Ç—Å—è:** –£—Ç–æ—á–Ω–∏—Ç—å –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.

---

### 4. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∏ –º–∞–ø–ø–∏–Ω–≥

#### 4.1. HTTP —Å—Ç–∞—Ç—É—Å –∫–æ–¥—ã ‚Üí –∏—Å–∫–ª—é—á–µ–Ω–∏—è
- **–í–æ–ø—Ä–æ—Å:** –ö–∞–∫ –º–∞–ø–ø–∏—Ç—å HTTP —Å—Ç–∞—Ç—É—Å –∫–æ–¥—ã –Ω–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏—è?
  - `401` ‚Üí `AuthenticationError` (–Ω–µ–≤–µ—Ä–Ω—ã–π/–∏—Å—Ç–µ–∫—à–∏–π —Ç–æ–∫–µ–Ω)
  - `429` ‚Üí `RateLimitError`
  - `400` ‚Üí `InvalidRequestError`
  - `408` –∏–ª–∏ timeout ‚Üí `TimeoutError`
  - `500+` ‚Üí `ProviderError` (–æ–±—â–∞—è –æ—à–∏–±–∫–∞)?

**–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:** –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –º–∞–ø–ø–∏–Ω–≥ –ø–æ —Å—Ç–∞—Ç—É—Å –∫–æ–¥–∞–º.

#### 4.2. –û—à–∏–±–∫–∏ –≤ —Ç–µ–ª–µ –æ—Ç–≤–µ—Ç–∞
- **–í–æ–ø—Ä–æ—Å:** GigaChat –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –æ—à–∏–±–∫–∏ –≤ JSON —Ñ–æ—Ä–º–∞—Ç–µ?
  - –°—Ç—Ä—É–∫—Ç—É—Ä–∞: `{"error": {"code": "...", "message": "..."}}`?
  - –ö–∞–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∫–æ–¥—ã –æ—à–∏–±–æ–∫ GigaChat?

**–¢—Ä–µ–±—É–µ—Ç—Å—è:** –ü—Ä–∏–º–µ—Ä—ã –æ—à–∏–±–æ–∫ –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏.

#### 4.3. –û–±—Ä–∞–±–æ—Ç–∫–∞ —Å–µ—Ç–µ–≤—ã—Ö –æ—à–∏–±–æ–∫
- **–í–æ–ø—Ä–æ—Å:** –ö–∞–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —Å–µ—Ç–µ–≤—ã–µ –æ—à–∏–±–∫–∏ (connection errors, SSL errors)?
  - `httpx.ConnectError` ‚Üí `TimeoutError` –∏–ª–∏ `ProviderError`?
  - `httpx.TimeoutException` ‚Üí `TimeoutError` (–æ—á–µ–≤–∏–¥–Ω–æ)
  - SSL –æ—à–∏–±–∫–∏ ‚Üí `AuthenticationError` –∏–ª–∏ `ProviderError`?

**–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:** 
- `httpx.TimeoutException` ‚Üí `TimeoutError`
- `httpx.ConnectError`, `httpx.NetworkError` ‚Üí `ProviderError` (—Å –∏–Ω—Ñ–æ—Ä–º–∞—Ç–∏–≤–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º)
- SSL –æ—à–∏–±–∫–∏ ‚Üí `ProviderError`

---

### 5. Health Check

#### 5.1. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è health_check
- **–í–æ–ø—Ä–æ—Å:** –ö–∞–∫ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `health_check()` –¥–ª—è GigaChat?
  - **–í–∞—Ä–∏–∞–Ω—Ç A:** –õ–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π –∑–∞–ø—Ä–æ—Å –∫ `/api/v1/models` –∏–ª–∏ –ø–æ–¥–æ–±–Ω–æ–º—É endpoint
  - **–í–∞—Ä–∏–∞–Ω—Ç B:** –ü—Ä–æ–≤–µ—Ä–∫–∞ OAuth2 (–ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞)
  - **–í–∞—Ä–∏–∞–Ω—Ç C:** –ö–æ–º–±–∏–Ω–∞—Ü–∏—è: OAuth2 + –ª–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π API –∑–∞–ø—Ä–æ—Å
  - **–í–∞—Ä–∏–∞–Ω—Ç D:** –¢–æ–ª—å–∫–æ –ø—Ä–æ–≤–µ—Ä–∫–∞ OAuth2 (–±—ã—Å—Ç—Ä–µ–µ)

**–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:** –í–∞—Ä–∏–∞–Ω—Ç B - –ø—Ä–æ–≤–µ—Ä–∫–∞ OAuth2 (–ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞). –ï—Å–ª–∏ —Ç–æ–∫–µ–Ω –ø–æ–ª—É—á–µ–Ω ‚Üí OK.

#### 5.2. Timeout –¥–ª—è health_check
- **–í–æ–ø—Ä–æ—Å:** –ö–∞–∫–æ–π timeout –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è health_check?
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `self.config.timeout`?
  - –ò–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–π –∫–æ—Ä–æ—Ç–∫–∏–π timeout (–Ω–∞–ø—Ä–∏–º–µ—Ä, 5 —Å–µ–∫—É–Ω–¥)?

**–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:** –ö–æ—Ä–æ—Ç–∫–∏–π timeout (5 —Å–µ–∫—É–Ω–¥) –¥–ª—è health_check, —á—Ç–æ–±—ã –Ω–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å.

---

### 6. Edge Cases

#### 6.1. –ò—Å—Ç–µ—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –≤–æ –≤—Ä–µ–º—è –∑–∞–ø—Ä–æ—Å–∞
- **–í–æ–ø—Ä–æ—Å:** –£–∂–µ –∑–∞–¥–∞–Ω–æ –≤ 1.3, –Ω–æ –≤–∞–∂–Ω–æ: –∫–∞–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å?
  - –ï—Å–ª–∏ –ø–æ–ª—É—á–∏–ª–∏ 401 –≤–æ –≤—Ä–µ–º—è `generate()`, –æ–±–Ω–æ–≤–∏—Ç—å —Ç–æ–∫–µ–Ω –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å?
  - –°–∫–æ–ª—å–∫–æ —Ä–∞–∑ –ø–æ–≤—Ç–æ—Ä—è—Ç—å?

**–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:** 1 —Ä–∞–∑ –æ–±–Ω–æ–≤–∏—Ç—å —Ç–æ–∫–µ–Ω –∏ –ø–æ–≤—Ç–æ—Ä–∏—Ç—å –∑–∞–ø—Ä–æ—Å. –ï—Å–ª–∏ —Å–Ω–æ–≤–∞ 401 ‚Üí `AuthenticationError`.

#### 6.2. Rate Limit
- **–í–æ–ø—Ä–æ—Å:** –ö–∞–∫ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å Rate Limit (429)?
  - –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `_retry_with_backoff()` –∏–∑ BaseProvider?
  - –ò–ª–∏ –æ–±—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ —Å —É—á–µ—Ç–æ–º `Retry-After` –∑–∞–≥–æ–ª–æ–≤–∫–∞?

**–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `_retry_with_backoff()`, –Ω–æ —Ç–∞–∫–∂–µ —É—á–∏—Ç—ã–≤–∞—Ç—å `Retry-After` –µ—Å–ª–∏ –µ—Å—Ç—å.

#### 6.3. –ù–µ–≤–∞–ª–∏–¥–Ω—ã–π Authorization key
- **–í–æ–ø—Ä–æ—Å:** –ß—Ç–æ –¥–µ–ª–∞—Ç—å –ø—Ä–∏ –Ω–µ–≤–∞–ª–∏–¥–Ω–æ–º Authorization key?
  - –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –∑–∞–ø—Ä–æ—Å–µ —Ç–æ–∫–µ–Ω–∞ –ø–æ–ª—É—á–∏—Ç—å –æ—à–∏–±–∫—É ‚Üí `AuthenticationError`
  - –õ–æ–≥–∏—Ä–æ–≤–∞—Ç—å –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–µ?

**–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:** –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ —Ç–æ–∫–µ–Ω–∞ –ø–æ–ª—É—á–∏—Ç—å 401 ‚Üí `AuthenticationError` —Å –ø–æ–Ω—è—Ç–Ω—ã–º —Å–æ–æ–±—â–µ–Ω–∏–µ–º.

---

### 7. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

#### 7.1. –¢–µ—Å—Ç—ã –±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ API
- **–í–æ–ø—Ä–æ—Å:** –ö–∞–∫ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å GigaChatProvider –±–µ–∑ —Ä–µ–∞–ª—å–Ω–æ–≥–æ API?
  - **–í–∞—Ä–∏–∞–Ω—Ç A:** –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `httpx` —Å –º–æ–∫–∞–º–∏ (responses library –∏–ª–∏ pytest-httpx)
  - **–í–∞—Ä–∏–∞–Ω—Ç B:** –°–æ–∑–¥–∞—Ç—å —Ç–µ—Å—Ç–æ–≤—ã–π –∫–ª–∞—Å—Å, –∫–æ—Ç–æ—Ä—ã–π –º–æ–∫–∏—Ä—É–µ—Ç HTTP-–∑–∞–ø—Ä–æ—Å—ã
  - **–í–∞—Ä–∏–∞–Ω—Ç C:** –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º API (—Ç—Ä–µ–±—É—é—Ç –∫–ª—é—á–∏)

**–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:** –ö–æ–º–±–∏–Ω–∞—Ü–∏—è A + C:
- Unit-—Ç–µ—Å—Ç—ã —Å `pytest-httpx` –¥–ª—è –º–æ–∫–æ–≤
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã —Å —Ä–µ–∞–ª—å–Ω—ã–º API (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, —Ç—Ä–µ–±—É—é—Ç –∫–ª—é—á–∏)

#### 7.2. –¢–µ—Å—Ç–æ–≤—ã–µ –¥–∞–Ω–Ω—ã–µ
- **–í–æ–ø—Ä–æ—Å:** –ö–∞–∫–∏–µ —Ç–µ—Å—Ç–æ–≤—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏ –ø–æ–∫—Ä—ã—Ç—å?
  - –£—Å–ø–µ—à–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞
  - –£—Å–ø–µ—à–Ω—ã–π –∑–∞–ø—Ä–æ—Å generate()
  - –ò—Å—Ç–µ—á–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ
  - –û—à–∏–±–∫–∏: 401, 429, 400, timeout
  - Health check (—É—Å–ø–µ—à–Ω—ã–π –∏ –Ω–µ—É—Å–ø–µ—à–Ω—ã–π)

**–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:** –í—Å–µ –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω—ã–µ —Å—Ü–µ–Ω–∞—Ä–∏–∏.

---

### 8. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã

#### 8.1. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ streaming
- **–í–æ–ø—Ä–æ—Å:** –ù—É–∂–Ω–∞ –ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ streaming (stream=True)?
  - **–í–∞—Ä–∏–∞–Ω—Ç A:** –ù–µ —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å –Ω–∞ –ø–µ—Ä–≤–æ–º —ç—Ç–∞–ø–µ (—Ç–æ–ª—å–∫–æ sync generate)
  - **–í–∞—Ä–∏–∞–Ω—Ç B:** –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –±–∞–∑–æ–≤—É—é –ø–æ–¥–¥–µ—Ä–∂–∫—É streaming

**–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:** –í–∞—Ä–∏–∞–Ω—Ç A - –Ω–µ —Ä–µ–∞–ª–∏–∑–æ–≤—ã–≤–∞—Ç—å –Ω–∞ –ø–µ—Ä–≤–æ–º —ç—Ç–∞–ø–µ. –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å `BaseProvider.generate()` –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `str`, –Ω–µ stream.

#### 8.2. –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –º–æ–¥–µ–ª–µ–π
- **–í–æ–ø—Ä–æ—Å:** –ù—É–∂–Ω–∞ –ª–∏ –ø–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—ã–±–æ—Ä–∞ –º–æ–¥–µ–ª–∏ —á–µ—Ä–µ–∑ `config.model`?
  - –ï—Å–ª–∏ –¥–∞, –∫–∞–∫–∏–µ –º–æ–¥–µ–ª–∏ –¥–æ—Å—Ç—É–ø–Ω—ã?
  - –í–∞–ª–∏–¥–∞—Ü–∏—è –º–æ–¥–µ–ª–∏ –ø—Ä–∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏?

**–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:** –ü–æ–¥–¥–µ—Ä–∂–∞—Ç—å —á–µ—Ä–µ–∑ `config.model`, –≤–∞–ª–∏–¥–∞—Ü–∏—é –Ω–µ –¥–µ–ª–∞—Ç—å (–ø—É—Å—Ç—å API –≤–µ—Ä–Ω–µ—Ç –æ—à–∏–±–∫—É –µ—Å–ª–∏ –º–æ–¥–µ–ª—å –Ω–µ–≤–µ—Ä–Ω–∞—è).

#### 8.3. –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ
- **–í–æ–ø—Ä–æ—Å:** –ß—Ç–æ –ª–æ–≥–∏—Ä–æ–≤–∞—Ç—å?
  - –ü–æ–ª—É—á–µ–Ω–∏–µ/–æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ (debug level)
  - –ó–∞–ø—Ä–æ—Å—ã –∫ API (debug level)
  - –û—à–∏–±–∫–∏ (error level)
  - Health check —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã (debug level)

**–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:** –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ `self.logger` —Å —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–º–∏ —É—Ä–æ–≤–Ω—è–º–∏.

---

## üìù –†–µ–∑—é–º–µ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤

**–¢—Ä–µ–±—É—é—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ–≥–æ —É—Ç–æ—á–Ω–µ–Ω–∏—è –ø–µ—Ä–µ–¥ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–µ–π:**

1. ‚úÖ **OAuth2 endpoint –∏ —Ñ–æ—Ä–º–∞—Ç –∑–∞–ø—Ä–æ—Å–∞** (URL, headers, body, response format)
2. ‚úÖ **–§–æ—Ä–º–∞—Ç messages –¥–ª—è GigaChat API** (–∫–∞–∫ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞—Ç—å prompt ‚Üí messages)
3. ‚úÖ **–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –æ—Ç–≤–µ—Ç–∞ API** (–≥–¥–µ –Ω–∞—Ö–æ–¥–∏—Ç—Å—è —Ç–µ–∫—Å—Ç –æ—Ç–≤–µ—Ç–∞)
4. ‚úÖ **–û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å RqUID –∑–∞–≥–æ–ª–æ–≤–∫–∞**
5. ‚úÖ **–§–æ—Ä–º–∞—Ç –æ—à–∏–±–æ–∫ –æ—Ç API** (—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ JSON –æ—à–∏–±–æ–∫)
6. ‚úÖ **–î–æ—Å—Ç—É–ø–Ω—ã–µ –º–æ–¥–µ–ª–∏ GigaChat** (–¥–ª—è –¥–µ—Ñ–æ–ª—Ç–Ω–æ–≥–æ –∑–Ω–∞—á–µ–Ω–∏—è –∏ –≤–∞–ª–∏–¥–∞—Ü–∏–∏)

**–ú–æ–∂–Ω–æ –ø—Ä–∏–Ω—è—Ç—å —Ä–µ—à–µ–Ω–∏—è —Å–∞–º–æ—Å—Ç–æ—è—Ç–µ–ª—å–Ω–æ (—Å –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è–º–∏ –≤—ã—à–µ):**

1. ‚úÖ –•—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ (–ø–æ–ª–µ –∫–ª–∞—Å—Å–∞ + –≤—Ä–µ–º—è –∏—Å—Ç–µ—á–µ–Ω–∏—è)
2. ‚úÖ Thread-safe –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ (asyncio.Lock)
3. ‚úÖ –ú–∞–ø–ø–∏–Ω–≥ HTTP —Å—Ç–∞—Ç—É—Å –∫–æ–¥–æ–≤ –Ω–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏—è
4. ‚úÖ Health check (–ø—Ä–æ–≤–µ—Ä–∫–∞ OAuth2)
5. ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ edge cases (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–∞ –ø—Ä–∏ 401)

---

## üéØ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

–ü–æ—Å–ª–µ –ø–æ–ª—É—á–µ–Ω–∏—è –æ—Ç–≤–µ—Ç–æ–≤ –Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã –º–æ–∂–Ω–æ –ø—Ä–∏—Å—Ç—É–ø–∏—Ç—å –∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:

1. –°–æ–∑–¥–∞—Ç—å `src/orchestrator/providers/gigachat.py`
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å OAuth2 –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—é
3. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `generate()` –º–µ—Ç–æ–¥
4. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å `health_check()` –º–µ—Ç–æ–¥
5. –î–æ–±–∞–≤–∏—Ç—å —ç–∫—Å–ø–æ—Ä—Ç –≤ `providers/__init__.py`
6. –ù–∞–ø–∏—Å–∞—Ç—å —Ç–µ—Å—Ç—ã
7. –û–±–Ω–æ–≤–∏—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é

